/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/cometd@3.1.1/cometd.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):(e.org=e.org||{},e.org.cometd=t())}(this,(function(){var e={isString:function(e){return null!=e&&("string"==typeof e||e instanceof String)},isArray:function(e){return null!=e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},setTimeout:function(e,t,n){return window.setTimeout((function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}}),n)},clearTimeout:function(e){window.clearTimeout(e)}},t=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,i,r){for(var o=[],s=0;s<e.length;++s){var a=e[s];!0===t[a].accept(n,i,r)&&o.push(a)}return o},this.negotiateTransport=function(n,i,r,o){for(var s=0;s<e.length;++s)for(var a=e[s],c=0;c<n.length;++c)if(a===n[c]){var u=t[a];if(!0===u.accept(i,r,o))return u}return null},this.add=function(n,i,r){for(var o=!1,s=0;s<e.length;++s)if(e[s]===n){o=!0;break}return o||("number"!=typeof r?e.push(n):e.splice(r,0,n),t[n]=i),!o},this.find=function(n){for(var i=0;i<e.length;++i)if(e[i]===n)return t[n];return null},this.remove=function(n){for(var i=0;i<e.length;++i)if(e[i]===n){e.splice(i,1);var r=t[n];return delete t[n],r}return null},this.clear=function(){e=[],t={}},this.reset=function(n){for(var i=0;i<e.length;++i)t[e[i]].reset(n)}},n=function(){var t,n,i;this.registered=function(e,i){t=e,n=i},this.unregistered=function(){t=null,n=null},this._debug=function(){n._debug.apply(n,arguments)},this._mixin=function(){return n._mixin.apply(n,arguments)},this.getConfiguration=function(){return n.getConfiguration()},this.getAdvice=function(){return n.getAdvice()},this.setTimeout=function(t,i){return e.setTimeout(n,t,i)},this.clearTimeout=function(t){e.clearTimeout(t)},this.convertToMessages=function(t){if(e.isString(t))try{return JSON.parse(t)}catch(e){throw this._debug("Could not convert to JSON the following string",'"'+t+'"'),e}if(e.isArray(t))return t;if(null==t)return[];if(t instanceof Object)return[t];throw"Conversion Error "+t+", typeof "+typeof t},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return t},this.getURL=function(){return i},this.setURL=function(e){i=e},this.send=function(e,t){throw"Abstract"},this.reset=function(e){this._debug("Transport",t,"reset",e?"initial":"retry")},this.abort=function(){this._debug("Transport",t,"aborted")},this.toString=function(){return this.getType()}};n.derive=function(e){function t(){}return t.prototype=e,new t};var i=function(){var t=new n,i=n.derive(t),r=0,o=null,s=[],a=[];function c(e){for(;a.length>0;){var t=a[0],n=t[0],i=t[1];if(n.url!==e.url||n.sync!==e.sync)break;a.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",i.id)}}function u(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,i=n;!0===t.metaConnect&&(i+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",i,"ms for the response, maxNetworkDelay",n);var r=this;t.timeout=this.setTimeout((function(){t.expired=!0;var n="Request "+t.id+" of transport "+r.getType()+" exceeded "+i+" ms max network delay",o={reason:n},s=t.xhr;o.httpCode=r.xhrStatus(s),r.abortXHR(s),r._debug(n),r.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,o)}),i)}}function l(e){var t=++r,n={id:t,metaConnect:!1,envelope:e};s.length<this.getConfiguration().maxConnections-1?(s.push(n),u.call(this,e,n)):(this._debug("Transport",this.getType(),"queueing request",t,"envelope",e),a.push([e,n]))}function f(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==o&&o.id!==t)throw"Longpoll request mismatch, completing request "+t;o=null}function h(t,n){var i=e.inArray(t,s);if(i>=0&&s.splice(i,1),a.length>0){var r=a.shift(),o=r[0],u=r[1];if(this._debug("Transport dequeued request",u.id),n)this.getConfiguration().autoBatch&&c.call(this,o),l.call(this,o),this._debug("Transport completed request",t.id,o);else{var f=this;this.setTimeout((function(){f.complete(u,!1,u.metaConnect);var e={reason:"Previous request failed"},t=u.xhr;e.httpCode=f.xhrStatus(t),o.onFailure(t,o.messages,e)}),0)}}}function d(e){if(null!==o)throw"Concurrent metaConnect requests not allowed, request id="+o.id+" not yet completed";var t=++r;this._debug("Transport",this.getType(),"metaConnect send, request",t,"envelope",e);var n={id:t,metaConnect:!0,envelope:e};u.call(this,e,n),o=n}return i.complete=function(e,t,n){n?f.call(this,e):h.call(this,e,t)},i.transportSend=function(e,t){throw"Abstract"},i.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},i.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},i.send=function(e,t){t?d.call(this,e):l.call(this,e)},i.abort=function(){t.abort();for(var e=0;e<s.length;++e){var n=s[e];n&&(this._debug("Aborting request",n),this.abortXHR(n.xhr)||this.transportFailure(n.envelope,n,{reason:"abort"}))}var i=o;i&&(this._debug("Aborting metaConnect request",i),this.abortXHR(i.xhr)||this.transportFailure(i.envelope,i,{reason:"abort"})),this.reset(!0)},i.reset=function(e){t.reset(e),o=null,s=[],a=[]},i.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},i.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},i},r=function(){var e=new i,t=n.derive(e),r=!0;return t.accept=function(e,t,n){return r||!t},t.xhrSend=function(e){var t=new XMLHttpRequest;t.withCredentials=!0,t.open("POST",e.url,!0!==e.sync);var n=e.headers;if(n)for(var i in n)n.hasOwnProperty(i)&&t.setRequestHeader(i,n[i]);return t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.onload=function(){200===t.status?e.onSuccess(t.responseText):e.onError(t.statusText)},t.onerror=function(){e.onError(t.statusText)},t.send(e.body),t},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var n=this;try{var i=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(e.messages),onSuccess:function(i){n._debug("Transport",n.getType(),"received response",i);var o=!1;try{var s=n.convertToMessages(i);0===s.length?(r=!1,n.transportFailure(e,t,{httpCode:204})):(o=!0,n.transportSuccess(e,t,s))}catch(i){if(n._debug(i),!o){r=!1;var a={exception:i};a.httpCode=n.xhrStatus(t.xhr),n.transportFailure(e,t,a)}}},onError:function(o,s){n._debug("Transport",n.getType(),"received error",o,s),r=!1;var a={reason:o,exception:s};a.httpCode=n.xhrStatus(t.xhr),i?n.setTimeout((function(){n.transportFailure(e,t,a)}),0):n.transportFailure(e,t,a)}}),i=!1}catch(i){r=!1,this.setTimeout((function(){n.transportFailure(e,t,{exception:i})}),0)}},t.reset=function(t){e.reset(t),r=!0},t},o=function(){var e=new i,t=n.derive(e),r=0;function o(e,t,n){var i=this;return function(){i.transportFailure(e,t,"error",n)}}return t.accept=function(e,t,n){return!0},t.jsonpSend=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),i="_cometd_jsonp_"+r++;window[i]=function(r){t.removeChild(n),delete window[i],e.onSuccess(r)};var o=e.url;o+=o.indexOf("?")<0?"?":"&",o+="jsonp="+i,o+="&message="+e.body,n.src=o,n.async=!0!==e.sync,n.type="application/javascript",n.onerror=function(t){e.onError("jsonp "+t.type)},t.appendChild(n)},t.transportSend=function(e,t){for(var n=this,i=0,r=e.messages.length,s=[];r>0;){var a=JSON.stringify(e.messages.slice(i,i+r)),c=e.url.length+encodeURI(a).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===r){var l="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(o.call(this,e,t,l),0)}--r}else s.push(r),i+=r,r=e.messages.length-i}var f=e;if(s.length>1){var h=0,d=s[0];this._debug("Transport",this.getType(),"split",e.messages.length,"messages into",s.join(" + ")),(f=this._mixin(!1,{},e)).messages=e.messages.slice(h,d),f.onSuccess=e.onSuccess,f.onFailure=e.onFailure;for(var g=1;g<s.length;++g){var p=this._mixin(!1,{},e);h=d,d+=s[g],p.messages=e.messages.slice(h,d),p.onSuccess=e.onSuccess,p.onFailure=e.onFailure,this.send(p,t.metaConnect)}}this._debug("Transport",this.getType(),"sending request",t.id,"envelope",f);try{var m=!0;this.jsonpSend({transport:this,url:f.url,sync:f.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(f.messages),onSuccess:function(e){var i=!1;try{var r=n.convertToMessages(e);0===r.length?n.transportFailure(f,t,{httpCode:204}):(i=!0,n.transportSuccess(f,t,r))}catch(e){n._debug(e),i||n.transportFailure(f,t,{exception:e})}},onError:function(e,i){var r={reason:e,exception:i};m?n.setTimeout((function(){n.transportFailure(f,t,r)}),0):n.transportFailure(f,t,r)}}),m=!1}catch(e){this.setTimeout((function(){n.transportFailure(f,t,{exception:e})}),0)}},t},s=function(){var t,i=new n,r=n.derive(i),o=!0,s=!1,a=!0,c=null,u=null,l=!1,f=null;function h(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function d(e){return e===u||e===c}function g(e,t,n){for(var i=[],r=0;r<t.messages.length;++r){var o=t.messages[r];o.id&&i.push(o.id)}e.envelopes[i.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function p(e){if(!u){var n=t.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",n);try{var i=t.getConfiguration().protocol;e.webSocket=i?new window.WebSocket(n,i):new window.WebSocket(n),u=e}catch(e){throw o=!1,this._debug("Exception while creating WebSocket object",e),e}a=!1!==t.getConfiguration().stickyReconnect;var r=this,l=t.getConfiguration().connectTimeout;l>0&&(e.connectTimer=this.setTimeout((function(){t._debug("Transport",r.getType(),"timed out while connecting to URL",n,":",l,"ms"),h.call(r,e,{code:1e3,reason:"Connect Timeout"})}),l));var f=function(n){n=n||{code:1e3},t._debug("WebSocket onclose",e,n,"connecting",u,"current",c),e.connectTimer&&r.clearTimeout(e.connectTimer),r.onClose(e,n)};e.webSocket.onopen=function(){t._debug("WebSocket onopen",e),e.connectTimer&&r.clearTimeout(e.connectTimer),d(e)?(u=null,c=e,s=!0,r.onOpen(e)):(t._warn("Closing extra WebSocket connection",this,"active connection",c),h.call(r,e,{code:1e3,reason:"Extra Connection"}))},e.webSocket.onclose=f,e.webSocket.onerror=function(){f({code:1e3,reason:"Error"})},e.webSocket.onmessage=function(n){t._debug("WebSocket onmessage",n,e),r.onMessage(e,n)},this._debug("Transport",this.getType(),"configured callbacks on",e)}}function m(e,n,i){var r=JSON.stringify(n.messages);e.webSocket.send(r),this._debug("Transport",this.getType(),"sent",n,"metaConnect =",i);var o=this.getConfiguration().maxNetworkDelay,s=o;i&&(s+=this.getAdvice().timeout,l=!0);for(var a=this,c=[],u=0;u<n.messages.length;++u)!function(){var i=n.messages[u];i.id&&(c.push(i.id),e.timeouts[i.id]=a.setTimeout((function(){t._debug("Transport",a.getType(),"timing out message",i.id,"after",s,"on",e),h.call(a,e,{code:1e3,reason:"Message Timeout"})}),s))}();this._debug("Transport",this.getType(),"waiting at most",s,"ms for messages",c,"maxNetworkDelay",o,", timeouts:",e.timeouts)}function v(e,t,n){try{null===e?(e=u||{envelopes:{},timeouts:{}},g.call(this,e,t,n),p.call(this,e)):(g.call(this,e,t,n),m.call(this,e,t,n))}catch(t){var i=this;this.setTimeout((function(){h.call(i,e,{code:1e3,reason:"Exception",exception:t})}),0)}}return r.reset=function(e){i.reset(e),o=!0,e&&(s=!1),a=!0,c=null,u=null,l=!1},r._notifySuccess=function(e,t){e.call(this,t)},r._notifyFailure=function(e,t,n,i){e.call(this,t,n,i)},r.onOpen=function(e){var t=e.envelopes;for(var n in this._debug("Transport",this.getType(),"opened",e,"pending messages",t),t)if(t.hasOwnProperty(n)){var i=t[n],r=i[0],o=i[1];f=r.onSuccess,m.call(this,e,r,o)}},r.onMessage=function(t,n){this._debug("Transport",this.getType(),"received websocket message",n,t);for(var i=!1,r=this.convertToMessages(n.data),o=[],s=0;s<r.length;++s){var a=r[s];if((/^\/meta\//.test(a.channel)||void 0===a.data)&&a.id){o.push(a.id);var c=t.timeouts[a.id];c&&(this.clearTimeout(c),delete t.timeouts[a.id],this._debug("Transport",this.getType(),"removed timeout for message",a.id,", timeouts",t.timeouts))}"/meta/connect"===a.channel&&(l=!1),"/meta/disconnect"!==a.channel||l||(i=!0)}for(var u=!1,h=t.envelopes,d=0;d<o.length;++d){var g=o[d];for(var p in h)if(h.hasOwnProperty(p)){var m=p.split(","),v=e.inArray(g,m);if(v>=0){u=!0,m.splice(v,1);var b=h[p][0],y=h[p][1];delete h[p],m.length>0&&(h[m.join(",")]=[b,y]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",h),this._notifySuccess(f,r),i&&this.webSocketClose(t,1e3,"Disconnect")},r.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),d(e)&&(o=a&&s,u=null,c=null);var n=e.timeouts;for(var i in e.timeouts={},n)n.hasOwnProperty(i)&&this.clearTimeout(n[i]);var r=e.envelopes;for(var f in e.envelopes={},r)if(r.hasOwnProperty(f)){var h=r[f][0];r[f][1]&&(l=!1);var g={websocketCode:t.code,reason:t.reason};t.exception&&(g.exception=t.exception),this._notifyFailure(h.onFailure,e,h.messages,g)}},r.registered=function(e,n){i.registered(e,n),t=n},r.accept=function(e,n,i){return this._debug("Transport",this.getType(),"accept, supported:",o),o&&!!window.WebSocket&&!1!==t.websocketEnabled},r.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t),v.call(this,c,e,t)},r.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},r.abort=function(){i.abort(),h.call(this,c,{code:1e3,reason:"Abort"}),this.reset(!0)},r},a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],c=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(n){var i,a,c,u,l,f=this,h=n||"default",d=!1,g=new t,p="disconnected",m=0,v=null,b=0,y=[],T=!1,w=0,x={},_=0,k=null,C=[],S={},I={},R={},L=!1,U=!1,E=0,q=0,A={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};function F(e,t){try{return e[t]}catch(e){return}}function B(t){return e.isString(t)}function P(e){return null!=e&&"function"==typeof e}function D(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function M(e,t){if(window.console){var n=window.console[e];if(P(n)){var i=new Date;[].splice.call(t,0,0,D(i.getHours(),2)+":"+D(i.getMinutes(),2)+":"+D(i.getSeconds(),2)+"."+D(i.getMilliseconds(),3)),n.apply(window.console,t)}}}function O(e){return/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(e)}function N(e){f._debug("Configuring cometd object with",e),B(e)&&(e={url:e}),e||(e={}),A=f._mixin(!1,A,e);var t=f.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var n=O(t),i=n[2],r=n[8],o=n[9];if(d=f._isCrossDomain(i),A.appendMessageTypeToURL)if(void 0!==o&&o.length>0)f._info("Appending message type to URI "+r+o+" is not supported, disabling 'appendMessageTypeToURL' configuration"),A.appendMessageTypeToURL=!1;else{var s=r.split("/"),a=s.length-1;r.match(/\/$/)&&(a-=1),s[a].indexOf(".")>=0&&(f._info("Appending message type to URI "+r+" is not supported, disabling 'appendMessageTypeToURL' configuration"),A.appendMessageTypeToURL=!1)}}function j(e){if(e){var t=x[e.channel];t&&t[e.id]&&(delete t[e.id],f._debug("Removed",e.listener?"listener":"subscription",e))}}function H(e){e&&!e.listener&&j(e)}function W(){for(var e in x)if(x.hasOwnProperty(e)){var t=x[e];if(t)for(var n in t)t.hasOwnProperty(n)&&H(t[n])}}function J(e){p!==e&&(f._debug("Status",p,"->",e),p=e)}function X(){return"disconnecting"===p||"disconnected"===p}function V(){return""+ ++m}function z(e,t,n,i,r){try{return t.call(e,i)}catch(e){var o=f.onExtensionException;if(P(o)){f._debug("Invoking extension exception handler",n,e);try{o.call(f,e,n,r,i)}catch(e){f._info("Exception during execution of extension exception handler",n,e)}}else f._info("Exception during execution of extension",n,e);return i}}function Z(e){for(var t=0;t<C.length&&null!=e;++t){var n=C[t],i=n.extension.outgoing;if(P(i)){var r=z(n.extension,i,n.name,e,!0);e=void 0===r?e:r}}return e}function $(e,t){var n=x[e];if(n)for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];if(r)try{r.callback.call(r.scope,t)}catch(e){var o=f.onListenerException;if(P(o)){f._debug("Invoking listener exception handler",r,e);try{o.call(f,e,r,r.listener,t)}catch(e){f._info("Exception during execution of listener exception handler",r,e)}}else f._info("Exception during execution of listener",r,t,e)}}}function G(e,t){$(e,t);for(var n=e.split("/"),i=n.length-1,r=i;r>0;--r){var o=n.slice(0,r).join("/")+"/*";r===i&&$(o,t),$(o+="*",t)}}function K(){null!==k&&e.clearTimeout(k),k=null}function Q(t,n){K();var i=S.interval+n;f._debug("Function scheduled in",i,"ms, interval =",S.interval,"backoff =",_,t),k=e.setTimeout(f,t,i)}function Y(e,t,n,r){for(var o=0;o<t.length;++o){var s=t[o],a=s.id;v&&(s.clientId=v),null!=(s=Z(s))?(s.id=a,t[o]=s):(delete I[a],t.splice(o--,1))}if(0!==t.length){var c=f.getURL();A.appendMessageTypeToURL&&(c.match(/\/$/)||(c+="/"),r&&(c+=r));var h={url:c,sync:e,messages:t,onSuccess:function(e){try{u.call(f,e)}catch(e){f._info("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var i=f.getTransport();n.connectionType=i?i.getType():"unknown",l.call(f,e,t,n)}catch(e){f._info("Exception during handling of failure",e)}}};f._debug("Send",h),i.send(h,n)}}function ee(e){b>0||!0===T?y.push(e):Y(!1,[e],!1)}function te(){_=0}function ne(){var e=y;y=[],e.length>0&&Y(!1,e,!1)}function ie(e){J("connecting"),Q((function(){!function(){if(!X()){var e={id:V(),channel:"/meta/connect",connectionType:i.getType()};U||(e.advice={timeout:0}),J("connecting"),f._debug("Connect sent",e),Y(!1,[e],!0,"connect"),J("connected")}}()}),e)}function re(e){e&&(S=f._mixin(!1,{},A.advice,e),f._debug("New advice",S))}function oe(e){if(K(),e&&i&&i.abort(),v=null,J("disconnected"),b=0,te(),i=null,L=!1,U=!1,y.length>0){var t=y;y=[],l.call(f,void 0,t,{reason:"Disconnected"})}}function se(e,t,n){var i=f.onTransportException;if(P(i)){f._debug("Invoking transport exception handler",e,t,n);try{i.call(f,n,e,t)}catch(e){f._info("Exception during execution of transport exception handler",e)}}}function ae(e,t){P(e)&&(t=e,e=void 0),v=null,W(),X()&&(g.reset(!0),re(A.advice)),b=0,T=!0,a=e,c=t;var n="1.0",r=f.getURL(),o=g.findTransportTypes(n,d,r),s={id:V(),version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:o,advice:{timeout:S.timeout,interval:S.interval}},u=f._mixin(!1,{},a,s);if(f._putCallback(u.id,t),!i&&!(i=g.negotiateTransport(o,n,d,r))){var l="Could not find initial transport among: "+g.getTransportTypes();throw f._warn(l),l}f._debug("Initial transport is",i.getType()),J("handshaking"),f._debug("Handshake sent",u),Y(!1,[u],!1,"handshake")}function ce(e,t){try{e.call(f,t)}catch(e){var n=f.onCallbackException;if(P(n)){f._debug("Invoking callback exception handler",e);try{n.call(f,e,t)}catch(e){f._info("Exception during execution of callback exception handler",e)}}else f._info("Exception during execution of message callback",e)}}function ue(e){var t=f._getCallback([e.id]);P(t)&&(delete I[e.id],ce(t,e))}function le(t){var n=R[t.id];if(delete R[t.id],n){f._debug("Handling remote call response for",t,"with context",n);var i=n.timeout;i&&e.clearTimeout(i);var r=n.callback;if(P(r))return ce(r,t),!0}return!1}function fe(e){f._debug("Transport failure handling",e),e.transport&&(i=e.transport),e.url&&i.setURL(e.url);var t=e.action,n=e.delay||0;switch(t){case"handshake":!function(e){J("handshaking"),T=!0,Q((function(){ae(a,c)}),e)}(n);break;case"retry":ie(n);break;case"none":oe(!0);break;default:throw"Unknown action "+t}}function he(e,t){ue(e),G("/meta/handshake",e),G("/meta/unsuccessful",e),X()&&(t.action="none"),f.onTransportFailure.call(f,e,t,fe)}function de(e){he(e,{cause:"failure",action:"handshake",transport:null})}function ge(e,t){G("/meta/connect",e),G("/meta/unsuccessful",e),X()&&(t.action="none"),f.onTransportFailure.call(f,e,t,fe)}function pe(e){U=!1,ge(e,{cause:"failure",action:"retry",transport:null})}function me(e){oe(!0),ue(e),G("/meta/disconnect",e),G("/meta/unsuccessful",e)}function ve(e){me(e)}function be(e){var t=x[e.subscription];if(t)for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];i&&!i.listener&&(delete t[n],f._debug("Removed failed subscription",i))}ue(e),G("/meta/subscribe",e),G("/meta/unsuccessful",e)}function ye(e){be(e)}function Te(e){ue(e),G("/meta/unsubscribe",e),G("/meta/unsuccessful",e)}function we(e){Te(e)}function xe(e){le(e)||(ue(e),G("/meta/publish",e),G("/meta/unsuccessful",e))}function _e(e){xe(e)}function ke(e){if(E=0,null!=(e=function(e){for(var t=0;t<C.length&&null!=e;++t){var n=A.reverseIncomingExtensions?C.length-1-t:t,i=C[n],r=i.extension.incoming;if(P(r)){var o=z(i.extension,r,i.name,e,!1);e=void 0===o?e:o}}return e}(e)))switch(re(e.advice),e.channel){case"/meta/handshake":!function(e){var t=f.getURL();if(e.successful){var n=f._isCrossDomain(O(t)[2]),r=g.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(null===r)return e.successful=!1,void he(e,{cause:"negotiation",action:"none",transport:null});i!==r&&(f._debug("Transport",i.getType(),"->",r.getType()),i=r),v=e.clientId,T=!1,ne(),e.reestablish=L,L=!0,ue(e),G("/meta/handshake",e),q=e["x-messages"]||0;var o=X()?"none":S.reconnect||"retry";switch(o){case"retry":te(),0===q?ie(0):f._debug("Processing",q,"handshake-delivered messages");break;case"none":oe(!0);break;default:throw"Unrecognized advice action "+o}}else he(e,{cause:"unsuccessful",action:S.reconnect||"handshake",transport:i})}(e);break;case"/meta/connect":!function(e){if(U=e.successful){G("/meta/connect",e);var t=X()?"none":S.reconnect||"retry";switch(t){case"retry":te(),ie(_);break;case"none":oe(!1);break;default:throw"Unrecognized advice action "+t}}else ge(e,{cause:"unsuccessful",action:S.reconnect||"retry",transport:i})}(e);break;case"/meta/disconnect":!function(e){e.successful?(oe(!1),ue(e),G("/meta/disconnect",e)):me(e)}(e);break;case"/meta/subscribe":!function(e){e.successful?(ue(e),G("/meta/subscribe",e)):be(e)}(e);break;case"/meta/unsubscribe":!function(e){e.successful?(ue(e),G("/meta/unsubscribe",e)):Te(e)}(e);break;default:!function(e){void 0!==e.data?le(e)||(G(e.channel,e),q>0&&0==--q&&(f._debug("Processed last handshake-delivered message"),ie(0))):void 0===e.successful?f._warn("Unknown Bayeux Message",e):e.successful?(ue(e),G("/meta/publish",e)):xe(e)}(e)}}function Ce(e){var t=x[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0;return!1}function Se(e,t){var n={scope:e,method:t};if(P(e))n.scope=void 0,n.method=e;else if(B(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!P(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!P(t))throw"Invalid callback "+t;return n}function Ie(e,t,n,i){var r=Se(t,n);f._debug("Adding",i?"listener":"subscription","on",e,"with scope",r.scope,"and callback",r.method);var o=++w,s={id:o,channel:e,scope:r.scope,callback:r.method,listener:i},a=x[e];return a||(a={},x[e]=a),a[o]=s,f._debug("Added",i?"listener":"subscription",s),s}this._mixin=function(e,t,n){for(var i=t||{},r=2;r<arguments.length;++r){var o=arguments[r];if(null!=o)for(var s in o)if(o.hasOwnProperty(s)){var a=F(o,s),c=F(i,s);if(a===t)continue;if(void 0===a)continue;if(e&&"object"==typeof a&&null!==a)if(a instanceof Array)i[s]=this._mixin(e,c instanceof Array?c:[],a);else{var u="object"!=typeof c||c instanceof Array?{}:c;i[s]=this._mixin(e,u,a)}else i[s]=a}}return i},this._warn=function(){M("warn",arguments)},this._info=function(){"warn"!==A.logLevel&&M("info",arguments)},this._debug=function(){"debug"===A.logLevel&&M("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host},this.send=ee,this._getCallback=function(e){return I[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return P(t)&&(I[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var r=this.getTransportRegistry(),o=this.getURL(),s=this._isCrossDomain(O(o)[2]),a=r.findTransportTypes("1.0",s,o);if("none"===t.action){if("/meta/handshake"===e.channel&&!t.transport){var c="Could not negotiate transport, client=["+a+"], server=["+e.supportedConnectionTypes+"]";this._warn(c),se(i.getType(),null,{reason:c,connectionType:i.getType(),transport:i})}}else if(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel){if(!t.transport){var u=r.negotiateTransport(a,"1.0",s,o);u?(this._debug("Transport",i.getType(),"->",u.getType()),se(i.getType(),u.getType(),e.failure),t.action="handshake",t.transport=u):(this._warn("Could not negotiate transport, client=["+a+"]"),se(i.getType(),null,e.failure),t.action="none")}"none"!==t.action&&this.increaseBackoffPeriod()}else{var l=(new Date).getTime();if(0===E&&(E=l),"retry"===t.action){t.delay=this.increaseBackoffPeriod();var h=S.maxInterval;if(h>0){var d=S.timeout+S.interval+h;l-E+_>d&&(t.action="handshake")}}"handshake"===t.action&&(t.delay=0,r.reset(!1),this.resetBackoffPeriod())}n.call(f,t)},this.receive=ke,u=function(e){f._debug("Received",e);for(var t=0;t<e.length;++t){ke(e[t])}},l=function(e,t,n){f._debug("handleFailure",e,t,n),n.transport=e;for(var i=0;i<t.length;++i){var r=t[i],o={id:r.id,successful:!1,channel:r.channel,failure:n};switch(n.message=r,r.channel){case"/meta/handshake":de(o);break;case"/meta/connect":pe(o);break;case"/meta/disconnect":ve(o);break;case"/meta/subscribe":o.subscription=r.subscription,ye(o);break;case"/meta/unsubscribe":o.subscription=r.subscription,we(o);break;default:_e(o)}}},this.registerTransport=function(e,t,n){var i=g.add(e,t,n);return i&&(this._debug("Registered transport",e),P(t.registered)&&t.registered(e,this)),i},this.unregisterTransport=function(e){var t=g.remove(e);return null!==t&&(this._debug("Unregistered transport",e),P(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){g.clear()},this.getTransportTypes=function(){return g.getTransportTypes()},this.findTransport=function(e){return g.find(e)},this.getTransportRegistry=function(){return g},this.configure=function(e){N.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){if("disconnected"!==p)throw"Illegal state: handshaken";ae(e,t)},this.disconnect=function(e,t,n){if(!X()){"boolean"!=typeof e&&(n=t,t=e,e=!1),P(t)&&(n=t,t=void 0);var i={id:V(),channel:"/meta/disconnect"},r=this._mixin(!1,{},t,i);f._putCallback(r.id,n),J("disconnecting"),Y(!0===e,[r],!1,"disconnect")}},this.startBatch=function(){++b,f._debug("Starting batch, depth",b)},this.endBatch=function(){!function(){if(--b,f._debug("Ending batch, depth",b),b<0)throw"Calls to startBatch() and endBatch() are not paired";0!==b||X()||T||ne()}()},this.batch=function(e,t){var n=Se(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!B(e))throw"Illegal argument type: channel must be a string";return Ie(e,t,n,!0)},this.removeListener=function(e){if(!e||!e.channel||!("id"in e))throw"Invalid argument: expected subscription, not "+e;j(e)},this.clearListeners=function(){x={}},this.subscribe=function(e,t,n,i,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!B(e))throw"Illegal argument type: channel must be a string";if(X())throw"Illegal state: disconnected";P(t)&&(r=i,i=n,n=t,t=void 0),P(i)&&(r=i,i=void 0);var o=!Ce(e),s=Ie(e,t,n,!1);if(o){var a={id:V(),channel:"/meta/subscribe",subscription:e},c=this._mixin(!1,{},i,a);f._putCallback(c.id,r),ee(c)}return s},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(X())throw"Illegal state: disconnected";P(t)&&(n=t,t=void 0),this.removeListener(e);var i=e.channel;if(!Ce(i)){var r={id:V(),channel:"/meta/unsubscribe",subscription:i},o=this._mixin(!1,{},t,r);f._putCallback(o.id,n),ee(o)}},this.resubscribe=function(e,t){if(H(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){W()},this.publish=function(e,t,n,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!B(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(X())throw"Illegal state: disconnected";P(t)?(i=t,t={},n=void 0):P(n)&&(i=n,n=void 0);var r={id:V(),channel:e,data:t},o=this._mixin(!1,{},n,r);f._putCallback(o.id,i),ee(o)},this.publishBinary=function(e,t,n,i,r){P(t)?(r=t,t=new ArrayBuffer(0),n=!0,i=void 0):P(n)?(r=n,n=!0,i=void 0):P(i)&&(r=i,i=void 0);var o={meta:i,data:t,last:n};this.publish(e,o,{ext:{binary:{}}},r)},this.remoteCall=function(t,n,i,r,o){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!B(t))throw"Illegal argument type: target must be a string";if(X())throw"Illegal state: disconnected";if(P(n)?(o=n,n={},i=A.maxNetworkDelay,r=void 0):P(i)?(o=i,i=A.maxNetworkDelay,r=void 0):P(r)&&(o=r,r=void 0),"number"!=typeof i)throw"Illegal argument type: timeout must be a number";t.match(/^\//)||(t="/"+t);var s="/service"+t,a={id:V(),channel:s,data:n},c=this._mixin(!1,{},r,a),u={callback:o};i>0&&(u.timeout=e.setTimeout(f,(function(){f._debug("Timing out remote call",c,"after",i,"ms"),xe({id:c.id,error:"406::timeout",successful:!1,failure:{message:c,reason:"Remote Call Timeout"}})}),i),f._debug("Scheduled remote call timeout",c,"in",i,"ms")),R[c.id]=u,ee(c)},this.remoteCallBinary=function(e,t,n,i,r,o){P(t)?(o=t,t=new ArrayBuffer(0),n=!0,i=void 0,r=A.maxNetworkDelay):P(n)?(o=n,n=!0,i=void 0,r=A.maxNetworkDelay):P(i)?(o=i,i=void 0,r=A.maxNetworkDelay):P(r)&&(o=r,r=A.maxNetworkDelay);var s={meta:i,data:t,last:n};this.remoteCall(e,s,r,{ext:{binary:{}}},o)},this.getStatus=function(){return p},this.isDisconnected=X,this.setBackoffIncrement=function(e){A.backoffIncrement=e},this.getBackoffIncrement=function(){return A.backoffIncrement},this.getBackoffPeriod=function(){return _},this.increaseBackoffPeriod=function(){return _<A.maxBackoff&&(_+=A.backoffIncrement),_},this.resetBackoffPeriod=function(){te()},this.setLogLevel=function(e){A.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!B(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,i=0;i<C.length;++i){if(C[i].name===e){n=!0;break}}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(C.push({name:e,extension:t}),this._debug("Registered extension",e),P(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!B(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<C.length;++n){var i=C[n];if(i.name===e){C.splice(n,1),t=!0,this._debug("Unregistered extension",e);var r=i.extension;P(r.unregistered)&&r.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<C.length;++t){var n=C[t];if(n.name===e)return n.extension}return null},this.getName=function(){return h},this.getClientId=function(){return v},this.getURL=function(){if(i){var e=i.getURL();if(e)return e;if(e=A.urls[i.getType()])return e}return A.url},this.getTransport=function(){return i},this.getConfiguration=function(){return this._mixin(!0,{},A)},this.getAdvice=function(){return this._mixin(!0,{},S)},window.WebSocket&&this.registerTransport("websocket",new s),this.registerTransport("long-polling",new r),this.registerTransport("callback-polling",new o)},Transport:n,RequestTransport:i,LongPollingTransport:r,CallbackPollingTransport:o,WebSocketTransport:s,Utils:e,Z85:{encode:function(e){var t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;for(var n=t.byteLength,i=n%4,r=4-(0===i?4:i),o=new DataView(t),s="",c=0,u=0;u<n+r;++u){var l=u>=n;if(c=256*c+(l?0:o.getUint8(u)),(u+1)%4==0){for(var f=52200625,h=5;h>0;--h){if(!l||h>r){var d=Math.floor(c/f)%85;s+=a[d]}f/=85}c=0}}return s},decode:function(e){for(var t=e.length%5,n=5-(0===t?5:t),i=0;i<n;++i)e+=a[a.length-1];for(var r=e.length,o=new ArrayBuffer(4*r/5-n),s=new DataView(o),u=0,l=0,f=0,h=0;h<r;++h){var d=e.charCodeAt(l++)-32;if(u=85*u+c[d],l%5==0){for(var g=16777216;g>=1;)f<s.byteLength&&s.setUint8(f++,Math.floor(u/g)%256),g/=256;u=0}}return o}}}}));
//# sourceMappingURL=/sm/1ed2ec051119815ed5d9ae45d90ab49712ad737f2fe7968a29a8ac134c17c3ee.map